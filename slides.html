<!DOCTYPE html>
<html>
  <head>
    <title>Reading &amp; Cleaning Data and Regular Expressions</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

	<center>
  <h2>
Reading & Cleaning Data<br/>
      Regular Expressions
      </h2>
</center>

<div style="padding-bottom: 70px">
<div style="float: left; valign: top; padding-left: 80px;">
Matt Espe <br/>
Postdoc<br/>
</div>
<div style="float: right; valign: top; padding-right: 30px; padding-bottom: 20px;">
Duncan Temple Lang <br/>
Director, Data Science Initiative<br/>
Professor, Statistics	<br/>    
</div>
</div>

### [https://github.com/dsidavis/data_cleaning_w_r](https://github.com/dsidavis/data_cleaning_w_r)

<div style="clear: both"/>

<!-- <hr width="50%"/> -->
<img src="http://dsi.ucdavis.edu/images/dsi_banner.png" width="30%" height="30%"></img>

---
layout: true
<img style="float: right" src="http://dsi.ucdavis.edu/images/dsi_brand_logo.png"></img>

---

# Goals

+ Process of cleaning data
+ Reading non-tabular data into R.

+ Intersection:  Regular Expressions
   + pattern matching and substitution in text

---

# Reading Data

---


# Cleaning Data

+ Cleaning data requires judgement and decision making in the presence of ambiguity.
  + You need to ask the owner and collector(s) of the data to explain possible issues.
  + You should explicitly record your decisions and actions (for you and others)
  + You should return to review your decisions and see how they affect conclusio

+ Cleaning requires thought about how the data collection could lead to errors.
   + Often general problems, but always possible context-specific issues.

+ Cleaning should exist as part of the data lifecycle, not separate
from it.

---

See [Barley.md](Barley.md)

---

# The Data Lifecycle

Is this how we use data?

<img src="linear.png" alt="USGS Data lifecycle" style="width: 800px;"/>

---

# Data Lifecycle (cont.)

+ In most cases, this is a cycle, not linear. E.g., you use the data, find
issues, fix them, get more data, etc. 
  + Data created
  + Cleaned/processed 
  + "Used" in some way

+ What if the original data is changed after it is cleaned?

+ What if the end or intermediate use is in Excel/GoogleSheets/OpenRefine, etc.?

---
# Program defensively!

Don't assume:
+ The data will never change
+ You will forever remember what you were doing in this moment
+ Your assumptions are correct (e.g., you might need to go back and correct
  a bad "fix")
+ You understand perfectly how errors occurred

Aim to write software rather than scripts

---

# Writing a script vs. software

+ script: fixes instances, (maybe) specialized to the data, assumes the data are
static. Breaks if the data change, assumes a linear workflow.

```
df[12, 3] = "Bob"
```
Why row 12? Why column 3? What if Dr. Smarty-pants inserts a new
column in position 1?

+ software: flexible to fix conditions, not specific instances. Data
can change without breaking script

```
df$names[df$names == "bob"] = "Bob" 
```
Invariant to order of rows/columns. If the data are already corrected,
has no effect.

But writing software is more effort (higher cost), requires more thought.
---

# R Functions which use Regex

+ grep() and grepl()
+ gregexpr() and regexpr()
+ regmatches()
+ sub() and gsub()
+ strsplit()
+ agrep()
+ adist()

+ Others from stringr and stringi packages.
   + e.g. str_extract()


## Shell Commands

+ grep, egrep, ag
+ find
---

# Regex Elements

+ Literals

+ Wildcard Character  `.`

+ Character Classes

+ Negated Character Classes

+ Positional Matching - Anchors  `^` `$`


+ Alternation

+ Case Insensitive matching

+ Word boundaries

+ Quantifiers

+ Grouping and Back-References ()

---
# Regex Extensions

  + Non-greedy Matching
      + Problems with greedy matching.
  	  + Common simple case, simple solution
	     + Anything except this character
	     + or any of these characters
      + *?

+ Positive Lookahead and Behind

+ Negative Lookahead and Behind

---
## Literals

---
					
## Wildcard Character  `.`

---
## Character Classes
---
## Negated Character Classes
---
## Positional Matching - Anchors  `^` `$`
---

## Alternation
---
## Case Insensitive matching
---
## Word boundaries
---
## Quantifiers
   + Optional pattern ?
   + Zero or more  *
   + One or more  \+
   + m or more   `{m,}`
   + n or fewer   `{,n}`
   + between m and n  `{m,n}`
---
## Grouping and Back-References ()
   +  () and \\1, \\2, etc.
   
---


## Extensions
---
### Non-greedy Matching
    + Problems with greedy matching.
	+ Common simple case, simple solution
	   + Anything except this character
	   + or any of these characters
    + *?
---
### Positive Lookahead and Behind
    + (?=  )   (?<= )
---	
### Negative Lookahead and Behind
    + (?!  )   (?<! )	



---
    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>    
  </body>
</html>
